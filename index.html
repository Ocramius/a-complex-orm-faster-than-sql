<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Doctrine 2 ORM Best Practices</title>

        <meta name="description" content="Doctrine 2 ORM Best Practices">
        <meta name="author" content="Marco Pivetta">

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

        <link rel="stylesheet" href="css/theme.css" id="theme">
        <link rel="stylesheet" href="bower_components/reveal.js/lib/css/zenburn.css">

        <!-- Printing and PDF exports -->
        <script>
            var link = document.createElement('link');
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = window.location.search.match(/print-pdf/gi) ? 'bower_components/reveal.js/css/print/pdf.css'
                : 'bower_components/reveal.js/css/print/paper.css';
            document.getElementsByTagName('head')[0].appendChild(link);
        </script>
    </head>
    <body>
        <div class="reveal">
            <div class="slides">
                
                    
                        <section><h1>Hi!</h1></section>

                    
                    
                
                    
                        <section><h1>I'm <span class="doctrine-color">Marco</span>!</h1>
</section>

                    
                    
                
                    
                        <section><h1><a href="https://twitter.com/Ocramius" target="_blank">Ocramius</a></h1>
</section>

                    
                    
                
                    
                        <section><img src="assets/img/ocramius.gif" width="40%" class="crisp-image"/></section>

                    
                    
                
                    
                        <section><img src="assets/img/roave.svg"/>
</section>

                    
                    
                
                    
                        <section><img src="assets/img/zf-logo.svg"/>
</section>

                    
                    
                
                    
                        <section><img src="assets/img/doctrine.svg"/>
</section>

                    
                    
                
                    
                        <section><h1>
    <span class="zf-color">Extremely</span>
    <span class="doctrine-color">Defensive</span>
    <span class="php-color">PHP</span>
</h1></section>

                    
                    
                
                    
                        <section><p>
    This talk is about <span class="doctrine-color">aggressive practices</span>.
</p>

<p class="fragment">
    These <span class="doctrine-color">practices</span> work well for <span class="zf-color">long-lived projects</span>.
</p>

<p class="fragment">
    Every <abbr class="doctrine-color" title="Open Source Software">OSS</abbr> project should probably adopt them.
</p>
</section>

                    
                    
                
                    
                        <section><p>
    I'm an <span class="zf-color">Extremist</span>.
</p>

<p class="fragment">
    I <span class="php-color">became</span> an <span class="zf-color">Extremist</span>.
</p>

<p class="fragment">
    I
    <span class="php-color">maintain</span>
    <strong>too many</strong>
    <span class="doctrine-color">projects</span>
    that allow
    <strong>too much</strong>.
</p>

<p class="fragment">
    <strong>Everyone</strong>
    wants a shiny
    <span class="zf-color">new feature</span>.
</p>
</section>

                    
                    
                
                    
                        <section data-background="assets/img/feature-creep.png" ></section>

                    
                    
                
                    
                        <section><h2>Know your <span class="php-color">Limits</span></h2>

<p class="fragment">
    If you don't like these practices, don't apply them ...
</p>

<p class="fragment">
    ... but please <span class="doctrine-color">think carefully</span> about what you will release
</p>
</section>

                    
                    
                
                    
                        <section><h2>
    Do you know
    <br/>
    <span class="doctrine-color">Defensive Driving</span>?
</h2>

<!-- @TODO: wikipedia quote? -->

<p class="fragment">
    <span class="doctrine-color">Defensive driving</span>
    <br/>
    =
    <br/>
    assuming that other drivers
    <span class="php-color">will make mistakes</span>
</p>
</section>

                    
                    
                
                    
                        <section><h2><strong>You</strong> are <span class="php-color">dumb</span></h2>
</section>

                    
                    
                
                    
                        <section><h2>No, I do not mean <strong>You</strong></h2>

<p class="fragment small">(Sorry!)</p></section>

                    
                    
                
                    
                        <section><h2><strong>I</strong> am <span class="php-color">dumb</span></h2>
</section>

                    
                    
                
                    
                        <section><h2><strong>We</strong> are <span class="php-color">dumb</span></h2>
</section>

                    
                    
                
                    
                        <section><h2><strong>Everyone</strong> is <span class="php-color">dumb</span></h2>

<p class="fragment">
    Those who don't admit it, <strong>are</strong> the <span class="php-color">dumbest</span>!
</p>
</section>

                    
                    
                
                    
                        <section><!-- @TODO: add oprah gif here -->
</section>

                    
                    
                
                    
                        <section><h2>
    <span class="doctrine-color">Defensive coding</span>
    <br/>
    is like
    <br/>
    <span class="zf-color">Defensive Driving</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    Be
    <span class="doctrine-color">Scared</span>
    by
    <br/>
    <span class="zf-color">Everyone's Code</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    Be
    <span class="doctrine-color">Scared</span>
    by
    <br/>
    <span class="zf-color"><strong>Your</strong> Code</span>
</h2>
</section>

                    
                    
                
                    
                        <section></section>

                    
                    
                
                    
                        <section><!-- @TODO: clean code book image -->
<h2>Clean Code (IMG)</h2>

<p class="fragment">
    Although this book is a bit
    <strong>too "easy"</strong>
    on
    <span class="doctrine-color">limits</span>.
</p>
</section>

                    
                    
                
                    
                        <section><!-- @TODO: effective-java book image -->
<h2>Effective Java (IMG)</h2></section>

                    
                    
                
                    
                        <section><h2>Poka Yoke</h2>

<p class="fragment">
    <span class="zf-color">Avoid</span>
    <span class="doctrine-color">Mistakes</span>
</p>
</section>

                    
                    
                
                    
                        <section><!-- @TODO: add rj45 image here -->

<p class="fragment">Only one way to plug it in</p>
</section>

                    
                    
                
                    
                        <section><!-- @TODO: add USB image here -->

<p class="fragment">Maybe <strong>NOT</strong> such a good design</p>
</section>

                    
                    
                
                    
                        <section><h2>
    Let's make
    <br/>
    <strong>one concept</strong>
    <br/>
    clear:
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    <span class="zf-color">Code</span>
    is
    <span class="php-color">Reusable</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2><strike>
    <span class="zf-color">Code</span>
    is
    <span class="php-color">Reusable</span>
</strike></h2>

<h2>
    <span class="zf-color">Code</span>
    is
    <strong>NOT</strong>
    <span class="php-color">Reusable</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    <span class="zf-color">Code</span>
    is
    <span class="php-color">Crap</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    <span class="doctrine-color">Abstractions</span>
    <br/>
    are
    <span class="zf-color">Reusable</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    Code for
    <br/>
    <span class="doctrine-color">your Use-case</span>
</h2>

<h2 class="fragment">
    <strong>NOT</strong> for your <br/><span class="php-color">re-use-case</span>
</h2>
</section>

                    
                    
                
                    
                        <section><blockquote cite="http://en.wikipedia.org/wiki/Sturgeon's_law">
    <p>ninety percent of everything is crap.</p>
    <cite>Theodore Sturgeon</cite>
</blockquote>
</section>

                    
                    
                
                    
                        <section><h2>
    Don't write
    <span class="zf-color">Crap</span>
</h2>

<h2 class="fragment">
    Don't write
    <span class="php-color">Code</span>
</h2>

<p class="fragment">Write only what you <strong>REALLY</strong> need</p></section>

                    
                    
                
                    
                        <section><h1>
    <span class="zf-color">Good</span>
    <span class="doctrine-color">Practices</span>
</h1>
</section>

                    
                    
                
                    
                        <section><h1>
    Assuming
    <abbr title="SOLID" class="doctrine-color">SOLID</abbr>
    <!-- @todo can't remember the SOLID acronym -->
    code
</h1>
</section>

                    
                    
                
                    
                        <section><h2>
    All
    <span class="php-color">State</span>
    should be
    <span class="doctrine-color">Encapsulated</span>
</h2>
</section>

                    
                    
                
                    
                        <section><pre><code class="trim">
class BankAccount
{
    // ...

    public function setLastRefresh(DateTime $lastRefresh)
    {
        $this->lastRefresh = $lastRefresh;
    }
}
</code></pre>

<p class="fragment">(examples are purposely simplified/silly!)</p>
</section>

                    
                    
                
                    
                        <section><pre><code class="trim">
$currentTime = new DateTime();

$bankAccount1->setLastRefresh($currentTime);
$bankAccount2->setLastRefresh($currentTime);
</code></pre>

<pre class="fragment"><code class="trim">
// ... stuff
</code></pre>

<pre class="fragment"><code class="trim">
$currentTime->setTimestamp($aTimestamp);
</code></pre>

</section>

                    
                    
                
                    
                        <section><pre><code class="trim">
class BankAccount
{
    // ...

    public function setLastRefresh(DateTime $lastRefresh)
    {
        $this->lastRefresh = clone $lastRefresh;
    }
}
</code></pre>

<pre><code class="trim">
class BankAccount
{
    // ...

    public function setLastRefresh(DateTimeImmutable $lastRefresh)
    {
        $this->lastRefresh = $lastRefresh;
    }
}
</code></pre>
</section>

                    
                    
                
                    
                        <section><pre><code class="trim">
class MoneyTransfer
{
    public function __construct(Money $amount, DateTime $transferDate)
    {
        $this->amount       = $amount;
        $this->transferDate = $transferDate;
    }
}
</code></pre>

<pre class="fragment"><code class="trim">
class MoneyTransfer
{
    public function __construct(Money $amount, DateTime $transferDate)
    {
        $this->amount       = $amount;
        $this->transferDate = clone $transferDate;
    }
}
</code></pre>
</section>

                    
                    
                
                    
                        <section><h2>
    <span class="zf-color">External Access</span>
    includes
    <span class="php-color">Subclasses</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    Make
    <span class="php-color">State</span>
    <span class="doctrine-color">Private</span>
</h2>

<p class="fragment">
    <span class="doctrine-color">Private</span>
    <span class="php-color">properties</span>
</p>
</section>

                    
                    
                
                    
                        <section><h2 class="fragment">
    <span class="doctrine-color">Private</span>
    <span class="php-color">properties</span>
</h2>

<p class="fragment">
    <strong>BY DEFAULT!</strong>
</p>
</section>

                    
                    
                
                    
                        <section><h2>
    The
    <span class="doctrine-color">Constructor</span>
    is the
    <strong>ONLY</strong>
    <span class="zf-color">injection point</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    <strong>No</strong>
    <span class="php-color">un-initialized properties</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    <span class="php-color">Optional</span>
    <span class="zf-color">Dependencies</span>
</h2>
</section>

                    
                    
                
                    
                        <section><pre><code class="trim">
class DbConnection
{
    public function __construct(...)
    {
        // ...
    }

    public function setLogger(Logger $logger = null)
    {
        $this->logger = $logger;
    }
}
</code></pre>
</section>

                    
                    
                
                    
                        <section><h2>
    <span class="php-color">Optional dependencies</span>
    <strong>Do Not Exist!</strong>
</h2>
</section>

                    
                    
                
                    
                        <section><pre><code class="trim">
class DbConnection
{
    public function __construct(..., Logger $logger)
    {
        // ...
    }

    // look ma, no setters!
}
</code></pre>

<pre><code class="trim">
$dbConnection = new DbConnection(..., new FakeLogger());
</code></pre>
</section>

                    
                    
                
                    
                        <section><h2>
    <strong>No</strong>
    <span class="php-color">Setters</span>
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    <span class="php-color">Setters</span>
    don't mean
    <strong>Anything</strong>, anyway
</h2>
</section>

                    
                    
                
                    
                        <section><h2>
    Make
    <span class="php-color">State</span>
    <span class="doctrine-color">Immutable</span>
</h2>

<p class="fragment">
    Greatly reduces
    <span class="php-color">bugs</span>
    and
    <span class="php-color">cognitive load</span>
</p>

<p class="fragment">
    <!-- @TODO PSR-7 link -->
    <a href="#TODO" class="doctrine-color">PSR-7</a>
    got this <strong>right</strong>!
</p>
</section>

                    
                    
                
                    
                        <section><h2>
    What about <span class="zf-color">performance</span>?
</h2>

<p class="fragment">
    Profile!
</p>

<p class="fragment">
    Profile!
</p>

<p class="fragment">
    Profile!
</p>

<p class="fragment">
    <code>> O(log(n))</code>
</p>
</section>

                    
                    
                
                    
                        <section><h2>
    <strong>Avoid</strong>
    <span class="php-color">Logic Switch Parameters</span>
</h2>
</section>

                    
                    
                
                    
                        <section><pre><code class="trim">
class Spammer
{
    public function spam($email, $template, $optOutLink = false)
    {
        // yes, this is a really bad spammer
    }
}
</code></pre>
</section>

                    
                    
                
                    
                        <section><pre><code class="trim">
class Spammer
{
    public function sendIllegalSpam($email, $template)
    {
        // without opt-out link
    }

    public function sendApparentlyLegalSpam($email, $template)
    {
        // with opt-out link
    }
}
</code></pre>
</section>

                    
                    
                
                    
                        <section><h2>Thanks!</h2>
</section>

                    
                    
                
            </div>
        </div>
        <script src="bower_components/reveal.js/lib/js/head.min.js"></script>
        <script src="bower_components/reveal.js/js/reveal.js"></script>

        <script>
            Reveal.initialize({
                controls:     true,
                progress:     true,
                history:      true,
                center:       true,
                transition:   'none',
                // Optional reveal.js plugins
                dependencies: [
                    {
                        src: 'bower_components/reveal.js/lib/js/classList.js',
                        condition: function() { return !document.body.classList; }
                    },
                    {
                        src: 'bower_components/reveal.js/plugin/markdown/marked.js',
                        condition: function() { return !!document.querySelector( '[data-markdown]' ); }
                    },
                    {
                        src: 'bower_components/reveal.js/plugin/markdown/markdown.js',
                        condition: function() { return !!document.querySelector( '[data-markdown]' ); }
                    },
                    {
                        src: 'bower_components/reveal.js/plugin/highlight/highlight.js',
                        async: true,
                        condition: function() { return !!document.querySelector( 'pre code' ); },
                        callback: function() { hljs.initHighlightingOnLoad(); }
                    },
                    {
                        src: 'bower_components/reveal.js/plugin/zoom-js/zoom.js',
                        async: true
                    },
                    {
                        src: 'bower_components/reveal.js/plugin/notes/notes.js',
                        async: true
                    }
                ]
            });
        </script>
    </body>
</html>
